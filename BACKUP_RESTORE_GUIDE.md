# H∆∞·ªõng D·∫´n S·ª≠ D·ª•ng H·ªá Th·ªëng Sao L∆∞u v√† Kh√¥i Ph·ª•c D·ªØ Li·ªáu

## T·ªïng Quan

H·ªá th·ªëng sao l∆∞u v√† kh√¥i ph·ª•c d·ªØ li·ªáu c·ªßa th∆∞ vi·ªán ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ ƒë·∫£m b·∫£o an to√†n d·ªØ li·ªáu v·ªõi c√°c t√≠nh nƒÉng:

- ‚úÖ Sao l∆∞u t·ª± ƒë·ªông h√†ng ng√†y
- ‚úÖ Sao l∆∞u th·ªß c√¥ng theo y√™u c·∫ßu
- ‚úÖ Kh√¥i ph·ª•c d·ªØ li·ªáu t·ª´ file sao l∆∞u
- ‚úÖ Qu·∫£n l√Ω v√† theo d√µi c√°c b·∫£n sao l∆∞u
- ‚úÖ D·ªçn d·∫πp t·ª± ƒë·ªông c√°c file c≈©
- ‚úÖ Giao di·ªán web th√¢n thi·ªán

## C√°c T√≠nh NƒÉng Ch√≠nh

### 1. Sao L∆∞u T·ª± ƒê·ªông
- **T·∫ßn su·∫•t**: H√†ng ng√†y l√∫c 2:00 s√°ng
- **Lo·∫°i**: Sao l∆∞u t·ª± ƒë·ªông
- **M√¥ t·∫£**: "Daily automatic backup"
- **L∆∞u tr·ªØ**: T·ª± ƒë·ªông gi·ªØ l·∫°i 30 ng√†y

### 2. Sao L∆∞u Th·ªß C√¥ng
- Truy c·∫≠p: **Admin Panel > Settings > Qu·∫£n L√Ω Sao L∆∞u D·ªØ Li·ªáu**
- Nh·∫•n n√∫t **"T·∫°o Sao L∆∞u Ngay"**
- Nh·∫≠p m√¥ t·∫£ cho b·∫£n sao l∆∞u
- X√°c nh·∫≠n t·∫°o sao l∆∞u

### 3. Kh√¥i Ph·ª•c D·ªØ Li·ªáu
- Nh·∫•n n√∫t **"Kh√¥i Ph·ª•c D·ªØ Li·ªáu"**
- Ch·ªçn file sao l∆∞u t·ª´ danh s√°ch
- Xem th√¥ng tin chi ti·∫øt file
- X√°c nh·∫≠n kh√¥i ph·ª•c (‚ö†Ô∏è **C·∫¢NH B√ÅO**: S·∫Ω thay th·∫ø to√†n b·ªô d·ªØ li·ªáu hi·ªán t·∫°i)

### 4. Qu·∫£n L√Ω Sao L∆∞u
- **Xem danh s√°ch**: T·∫•t c·∫£ c√°c b·∫£n sao l∆∞u
- **L·ªçc theo lo·∫°i**: Th·ªß c√¥ng, T·ª± ƒë·ªông, ƒê·ªãnh k·ª≥
- **T·∫£i v·ªÅ**: Download file sao l∆∞u
- **X√≥a**: X√≥a file sao l∆∞u kh√¥ng c·∫ßn thi·∫øt

## S·ª≠ D·ª•ng Giao Di·ªán Web

### Dashboard Sao L∆∞u
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üìä Th·ªëng K√™ Sao L∆∞u                                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üìÅ T·ªïng Sao L∆∞u    ‚úÖ Th√†nh C√¥ng    üíæ Dung L∆∞·ª£ng    ‚è∞ 7 Ng√†y Qua ‚îÇ
‚îÇ     15              14              245.6 MB         3      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### C√°c N√∫t Thao T√°c
- **üîµ T·∫°o Sao L∆∞u Ngay**: T·∫°o b·∫£n sao l∆∞u m·ªõi ngay l·∫≠p t·ª©c
- **üîµ Kh√¥i Ph·ª•c D·ªØ Li·ªáu**: Kh√¥i ph·ª•c t·ª´ file sao l∆∞u c√≥ s·∫µn
- **üü¢ L√†m M·ªõi Danh S√°ch**: C·∫≠p nh·∫≠t danh s√°ch sao l∆∞u
- **üü° C√†i ƒê·∫∑t Sao L∆∞u**: C·∫•u h√¨nh c√°c t√πy ch·ªçn sao l∆∞u

### B·∫£ng Danh S√°ch Sao L∆∞u
| T√™n File | Lo·∫°i | Ng√†y T·∫°o | K√≠ch Th∆∞·ªõc | M√¥ T·∫£ | Thao T√°c |
|----------|------|----------|------------|-------|----------|
| backup_2024_01_20_14_30_15.sql | Th·ªß C√¥ng | 20/01/2024 14:30 | 45.2 MB | Sao l∆∞u tr∆∞·ªõc khi c·∫≠p nh·∫≠t | üì• üîÑ üóëÔ∏è |

## S·ª≠ D·ª•ng Command Line

### 1. T·∫°o Sao L∆∞u
```bash
# Sao l∆∞u th·ªß c√¥ng
php artisan backup:create --type=manual --description="Sao l∆∞u tr∆∞·ªõc khi c·∫≠p nh·∫≠t h·ªá th·ªëng"

# Sao l∆∞u t·ª± ƒë·ªông
php artisan backup:create --type=automatic --description="Sao l∆∞u t·ª± ƒë·ªông"

# Sao l∆∞u ƒë·ªãnh k·ª≥
php artisan backup:create --type=scheduled --description="Sao l∆∞u ƒë·ªãnh k·ª≥ h√†ng tu·∫ßn"
```

### 2. Kh√¥i Ph·ª•c Sao L∆∞u
```bash
# Kh√¥i ph·ª•c v·ªõi x√°c nh·∫≠n
php artisan backup:restore backup_2024_01_20_14_30_15.sql

# Kh√¥i ph·ª•c kh√¥ng c·∫ßn x√°c nh·∫≠n (c·∫©n th·∫≠n!)
php artisan backup:restore backup_2024_01_20_14_30_15.sql --force
```

### 3. Xem Danh S√°ch Sao L∆∞u
```bash
# Xem t·∫•t c·∫£ sao l∆∞u
php artisan backup:list

# Xem sao l∆∞u th·ªß c√¥ng
php artisan backup:list --type=manual

# Gi·ªõi h·∫°n s·ªë l∆∞·ª£ng hi·ªÉn th·ªã
php artisan backup:list --limit=5
```

### 4. D·ªçn D·∫πp Sao L∆∞u C≈©
```bash
# Xem tr∆∞·ªõc nh·ªØng file s·∫Ω b·ªã x√≥a (dry-run)
php artisan backup:cleanup --days=30 --dry-run

# X√≥a c√°c file c≈© h∆°n 30 ng√†y
php artisan backup:cleanup --days=30

# X√≥a c√°c file c≈© h∆°n 7 ng√†y
php artisan backup:cleanup --days=7
```

## C·∫•u H√¨nh T·ª± ƒê·ªông

### Scheduler (app/Console/Kernel.php)
```php
protected function schedule(Schedule $schedule)
{
    // Sao l∆∞u t·ª± ƒë·ªông h√†ng ng√†y l√∫c 2:00
    $schedule->command('backup:create --type=automatic --description="Daily automatic backup"')
             ->dailyAt('02:00')
             ->withoutOverlapping()
             ->runInBackground();
    
    // D·ªçn d·∫πp sao l∆∞u c≈© h√†ng tu·∫ßn (gi·ªØ l·∫°i 30 ng√†y)
    $schedule->command('backup:cleanup --days=30')
             ->weekly()
             ->sundays()
             ->at('03:00')
             ->withoutOverlapping()
             ->runInBackground();
}
```

### C·∫•u H√¨nh Database
ƒê·∫£m b·∫£o file `.env` c√≥ c·∫•u h√¨nh database ƒë√∫ng:
```env
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=quanlythuvien
DB_USERNAME=root
DB_PASSWORD=
```

## C·∫•u Tr√∫c File Sao L∆∞u

### V·ªã Tr√≠ L∆∞u Tr·ªØ
- **Th∆∞ m·ª•c**: `storage/app/backups/`
- **ƒê·ªãnh d·∫°ng t√™n**: `backup_YYYY_MM_DD_HH_MM_SS.sql`
- **V√≠ d·ª•**: `backup_2024_01_20_14_30_15.sql`

### Th√¥ng Tin Metadata
M·ªói b·∫£n sao l∆∞u l∆∞u tr·ªØ th√¥ng tin:
```json
{
    "table_count": 25,
    "total_records": 15420,
    "tables": {
        "users": 150,
        "books": 5000,
        "borrows": 3200,
        "readers": 800
    },
    "database_size": 45.2
}
```

## B·∫£o M·∫≠t v√† An To√†n

### Quy·ªÅn Truy C·∫≠p
- **Xem sao l∆∞u**: `view-settings`
- **T·∫°o sao l∆∞u**: `manage-backup`
- **Kh√¥i ph·ª•c**: `manage-backup`
- **X√≥a sao l∆∞u**: `manage-backup`

### Khuy·∫øn Ngh·ªã B·∫£o M·∫≠t
1. **Sao l∆∞u ƒë·ªãnh k·ª≥**: √çt nh·∫•t h√†ng ng√†y
2. **L∆∞u tr·ªØ ngo√†i**: Copy file sao l∆∞u ra ·ªï c·ª©ng kh√°c
3. **Ki·ªÉm tra t√≠nh to√†n v·∫πn**: Validate file sao l∆∞u tr∆∞·ªõc khi kh√¥i ph·ª•c
4. **Test kh√¥i ph·ª•c**: Th·ª≠ nghi·ªám kh√¥i ph·ª•c tr√™n m√¥i tr∆∞·ªùng test

## X·ª≠ L√Ω S·ª± C·ªë

### L·ªói Th∆∞·ªùng G·∫∑p

#### 1. L·ªói "mysqldump command not found"
```bash
# C√†i ƒë·∫∑t MySQL client tools
# Ubuntu/Debian:
sudo apt-get install mysql-client

# CentOS/RHEL:
sudo yum install mysql
```

#### 2. L·ªói Permission Denied
```bash
# C·∫•p quy·ªÅn cho th∆∞ m·ª•c storage
chmod -R 755 storage/
chown -R www-data:www-data storage/
```

#### 3. L·ªói Database Connection
- Ki·ªÉm tra c·∫•u h√¨nh database trong `.env`
- ƒê·∫£m b·∫£o MySQL service ƒëang ch·∫°y
- Ki·ªÉm tra username/password

#### 4. File Sao L∆∞u B·ªã H·ªèng
```bash
# Ki·ªÉm tra t√≠nh to√†n v·∫πn file
php artisan backup:validate backup_2024_01_20_14_30_15.sql

# T·∫°o sao l∆∞u m·ªõi
php artisan backup:create --type=manual --description="Emergency backup"
```

### Log Files
- **Laravel Log**: `storage/logs/laravel.log`
- **Backup Log**: T√¨m ki·∫øm "Backup" trong log file

## API Endpoints

### REST API
```http
# T·∫°o sao l∆∞u
POST /admin/settings/backup/create
Content-Type: application/json
{
    "description": "Manual backup"
}

# Kh√¥i ph·ª•c sao l∆∞u
POST /admin/settings/backup/restore
Content-Type: application/json
{
    "backup_file": "backup_2024_01_20_14_30_15.sql"
}

# L·∫•y danh s√°ch sao l∆∞u
GET /admin/settings/backup/list

# T·∫£i file sao l∆∞u
GET /admin/settings/backup/download/{filename}

# X√≥a file sao l∆∞u
DELETE /admin/settings/backup/{filename}

# Th·ªëng k√™ sao l∆∞u
GET /admin/settings/backup/stats
```

## Monitoring v√† B√°o C√°o

### Th·ªëng K√™ Hi·ªÉn Th·ªã
- **T·ªïng s·ªë sao l∆∞u**: T·ªïng s·ªë file sao l∆∞u ƒë√£ t·∫°o
- **Sao l∆∞u th√†nh c√¥ng**: S·ªë file sao l∆∞u ho√†n th√†nh
- **Sao l∆∞u th·∫•t b·∫°i**: S·ªë file sao l∆∞u b·ªã l·ªói
- **T·ªïng dung l∆∞·ª£ng**: T·ªïng k√≠ch th∆∞·ªõc t·∫•t c·∫£ file sao l∆∞u
- **Sao l∆∞u g·∫ßn ƒë√¢y**: S·ªë sao l∆∞u trong 7 ng√†y qua

### C·∫£nh B√°o
- ‚ö†Ô∏è Kh√¥ng c√≥ sao l∆∞u trong 24 gi·ªù
- ‚ö†Ô∏è Dung l∆∞·ª£ng ·ªï c·ª©ng s·∫Øp ƒë·∫ßy
- ‚ö†Ô∏è Sao l∆∞u th·∫•t b·∫°i li√™n ti·∫øp
- ‚ö†Ô∏è File sao l∆∞u b·ªã h·ªèng

## K·∫øt Lu·∫≠n

H·ªá th·ªëng sao l∆∞u v√† kh√¥i ph·ª•c d·ªØ li·ªáu ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ ƒë·∫£m b·∫£o:
- **T√≠nh kh·∫£ d·ª•ng cao**: Sao l∆∞u t·ª± ƒë·ªông, kh√¥ng c·∫ßn can thi·ªáp
- **D·ªÖ s·ª≠ d·ª•ng**: Giao di·ªán web tr·ª±c quan, command line ƒë∆°n gi·∫£n
- **An to√†n**: X√°c nh·∫≠n tr∆∞·ªõc khi kh√¥i ph·ª•c, ki·ªÉm tra t√≠nh to√†n v·∫πn
- **Hi·ªáu qu·∫£**: D·ªçn d·∫πp t·ª± ƒë·ªông, qu·∫£n l√Ω dung l∆∞·ª£ng

ƒê·ªÉ ƒë·∫£m b·∫£o an to√†n d·ªØ li·ªáu, h√£y:
1. Ki·ªÉm tra sao l∆∞u t·ª± ƒë·ªông ho·∫°t ƒë·ªông ƒë√∫ng
2. Test kh√¥i ph·ª•c ƒë·ªãnh k·ª≥
3. L∆∞u tr·ªØ file sao l∆∞u ·ªü nhi·ªÅu n∆°i
4. Theo d√µi log v√† th·ªëng k√™ th∆∞·ªùng xuy√™n
