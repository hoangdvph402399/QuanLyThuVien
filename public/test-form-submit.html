<!DOCTYPE html>
<html>
<head>
    <title>Test Form Submit</title>
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .form-group { margin: 20px 0; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group select, .form-group textarea { 
            width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; 
        }
        .btn { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; border-radius: 4px; }
        .btn:hover { background: #0056b3; }
        .result { margin: 20px 0; padding: 15px; border: 1px solid #ddd; background: #f9f9f9; }
        .error { color: red; }
        .success { color: green; }
        .required { color: red; }
    </style>
</head>
<body>
    <h1>Test Form Submit - Purchasable Book</h1>
    
    <form id="testForm" action="{{ route('admin.purchasable-books.store') }}" method="POST" enctype="multipart/form-data">
        @csrf
        
        <div class="form-group">
            <label for="ten_sach">Tên sách <span class="required">*</span></label>
            <input type="text" name="ten_sach" id="ten_sach" value="Test Book" required>
        </div>
        
        <div class="form-group">
            <label for="tac_gia">Tác giả <span class="required">*</span></label>
            <input type="text" name="tac_gia" id="tac_gia" value="Test Author" required>
        </div>
        
        <div class="form-group">
            <label for="mo_ta">Mô tả</label>
            <textarea name="mo_ta" id="mo_ta" rows="3">This is a test book description</textarea>
        </div>
        
        <div class="form-group">
            <label for="gia">Giá (VNĐ) <span class="required">*</span></label>
            <input type="number" name="gia" id="gia" value="100000" min="0" required>
        </div>
        
        <div class="form-group">
            <label for="dinh_dang">Định dạng <span class="required">*</span></label>
            <select name="dinh_dang" id="dinh_dang" required>
                <option value="">Chọn định dạng</option>
                <option value="PDF" selected>PDF</option>
                <option value="EPUB">EPUB</option>
                <option value="MOBI">MOBI</option>
                <option value="AZW">AZW</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="nha_xuat_ban">Nhà xuất bản <span class="required">*</span></label>
            <input type="text" name="nha_xuat_ban" id="nha_xuat_ban" value="Test Publisher" required>
        </div>
        
        <div class="form-group">
            <label for="nam_xuat_ban">Năm xuất bản <span class="required">*</span></label>
            <input type="number" name="nam_xuat_ban" id="nam_xuat_ban" value="2024" min="1900" max="2025" required>
        </div>
        
        <div class="form-group">
            <label for="isbn">ISBN</label>
            <input type="text" name="isbn" id="isbn" value="978-1234567890">
        </div>
        
        <div class="form-group">
            <label for="so_trang">Số trang</label>
            <input type="number" name="so_trang" id="so_trang" value="200" min="1">
        </div>
        
        <div class="form-group">
            <label for="ngon_ngu">Ngôn ngữ</label>
            <input type="text" name="ngon_ngu" id="ngon_ngu" value="Tiếng Việt">
        </div>
        
        <div class="form-group">
            <label for="kich_thuoc_file">Kích thước file (KB)</label>
            <input type="number" name="kich_thuoc_file" id="kich_thuoc_file" value="1024" min="0">
        </div>
        
        <div class="form-group">
            <label for="trang_thai">Trạng thái <span class="required">*</span></label>
            <select name="trang_thai" id="trang_thai" required>
                <option value="active" selected>Hoạt động</option>
                <option value="inactive">Tạm dừng</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="hinh_anh">Ảnh bìa</label>
            <input type="file" name="hinh_anh" id="hinh_anh" accept="image/*">
        </div>
        
        <div class="form-group">
            <button type="submit" class="btn">Test Submit</button>
            <button type="button" class="btn" onclick="testAjax()" style="background: #28a745; margin-left: 10px;">Test AJAX</button>
        </div>
    </form>
    
    <div id="result" class="result" style="display: none;"></div>
    
    <h2>Debug Info:</h2>
    <div id="debug"></div>
    
    <script>
        // Test form submit
        document.getElementById('testForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const debugDiv = document.getElementById('debug');
            
            // Debug form data
            let debugInfo = '<h3>Form Data:</h3><ul>';
            for (let [key, value] of formData.entries()) {
                debugInfo += `<li><strong>${key}:</strong> ${value}</li>`;
            }
            debugInfo += '</ul>';
            debugDiv.innerHTML = debugInfo;
            
            // Show loading
            showResult('Đang submit form...', 'info');
            
            // Submit form
            fetch(this.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => {
                if (response.redirected) {
                    showResult(`Form submitted successfully! Redirected to: ${response.url}`, 'success');
                    // Follow redirect
                    window.location.href = response.url;
                } else {
                    return response.text();
                }
            })
            .then(data => {
                if (data) {
                    showResult(`Response: ${data}`, 'info');
                }
            })
            .catch(error => {
                showResult(`Error: ${error.message}`, 'error');
            });
        });
        
        // Test AJAX submit
        function testAjax() {
            const formData = new FormData(document.getElementById('testForm'));
            
            showResult('Testing AJAX submit...', 'info');
            
            fetch('{{ route("admin.purchasable-books.store") }}', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                showResult(`AJAX Response: ${JSON.stringify(data, null, 2)}`, 'info');
            })
            .catch(error => {
                showResult(`AJAX Error: ${error.message}`, 'error');
            });
        }
        
        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = message;
            resultDiv.className = `result ${type}`;
            resultDiv.style.display = 'block';
        }
    </script>
</body>
</html>
